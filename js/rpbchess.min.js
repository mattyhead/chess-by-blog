var RPBChess=function(){"use strict";function Et(e){this.fun=e}function St(e,t){this.fen=e,this[I]=t;for(var n=2;n<arguments[a];++n){var r=new RegExp("%"+(n-1)+"\\$s");this[I]=this[I].replace(r,arguments[n])}}function xt(e,t,n){this.position=e,this.notation=t,this[I]=n;for(var r=3;r<arguments[a];++r){var i=new RegExp("%"+(r-2)+"\\$s");this[I]=this[I].replace(i,arguments[r])}}function Vt(e){return e>=2&&e<=7}function $t(e){return e>=1&&e<=4}function Gt(e){if(typeof e===o){if(/^[aceg][1357]$/.test(e)||/^[bdfh][2468]$/.test(e))return"b";if(/^[aceg][2468]$/.test(e)||/^[bdfh][1357]$/.test(e))return"w"}throw new Et("squareColor()")}function rn(e){if(typeof e!==o||!/^[a-h][1-8]$/.test(e))return-1;var t=nn[f](e[0]),n=tn[f](e[1]);return n*16+t}function sn(e){return typeof e===o?en[f](e):-1}function on(e){return nn[e%16]+tn[Math[K](e/16)]}function un(n){typeof n===m||n===c||n==="start"?this.reset():n==="empty"?this.clear():n instanceof un?(this[t]=n[t].slice(),this[e]=n[e],this[i]=n[i].slice(),this[r]=n[r],this[d]=n[d],this[v]=n[v].slice()):fn(this,n,s)}function an(n,s,o){var u="";for(var a=7;a>=0;--a){a!==7&&(u+="/");var f=0;for(var l=0;l<8;++l){var c=n[t][a*16+l];c<0?++f:(f>0&&(u+=f,f=0),u+=Yt[c])}f>0&&(u+=f)}return u+=gt+en[n[e]]+gt+ln(n[i])+gt,n[r]<0?u+=ft:u+=nn[n[r]]+(n[e]===Tt?"6":"3"),u+=gt+s+gt+o,u}function fn(n,s,o){s=s.replace(/^\s+|\s+$/g,"");var u=s.split(/\s+/);if(u[a]!==6)throw new St(s,wt[W]);var l=u[0].split("/");if(l[a]!==8)throw new St(s,wt[N]);n.clear(),n[d]=c;for(var h=7;h>=0;--h){var p=l[7-h],v=0,m=0;while(v<p[a]&&m<8){var y=p[v],b=Yt[f](y);if(/^[1-8]$/.test(y))m+=parseInt(y,10);else{if(!(b>=0))throw new St(s,wt[L],y);n[t][h*16+m]=b,++m}++v}if(v!==p[a]||m!==8)throw new St(s,wt[T],wt[nt][7-h])}n[e]=en[f](u[1]);if(n[e]<0)throw new St(s,wt[it]);n[i]=cn(u[2],o);if(n[i]===c)throw new St(s,wt[F]);var w=u[3];if(w!==ft){if(!/^[a-h][36]$/.test(w))throw new St(s,wt[V]);if(o&&(w[1]==="3"&&n[e]===Tt||w[1]==="6"&&n[e]===Nt))throw new St(s,wt[M]);n[r]=nn[f](w[0])}var E=o?/^(?:0|[1-9][0-9]*)$/:/^[0-9]+$/;if(!E.test(u[4]))throw new St(s,wt[g],wt[nt][4]);if(!E.test(u[5]))throw new St(s,wt[g],wt[nt][5]);return{fiftyMoveClock:parseInt(u[4],10),fullMoveNumber:parseInt(u[5],10)}}function ln(e){var t="";return e[Tt]&128&&(t+="K"),e[Tt]&1&&(t+="Q"),e[Nt]&128&&(t+="k"),e[Nt]&1&&(t+="q"),t===""?ft:t}function cn(e,t){var n=[0,0];return e===ft?n:(t?/^K?Q?k?q?$/:/^[KQkq]*$/).test(e)?(e[f]("K")>=0&&(n[Tt]|=128),e[f]("Q")>=0&&(n[Tt]|=1),e[f]("k")>=0&&(n[Nt]|=128),e[f]("q")>=0&&(n[Nt]|=1),n):c}function hn(e,n){var r=e[t][n];return r<0?ft:{piece:Zt[Math[K](r/2)],color:en[r%2]}}function pn(e,n,r){if(r===ft)return e[t][n]=Ct,e[d]=c,h;if(typeof r===ct&&typeof r.piece===o&&typeof r.color===o){var i=Zt[f](r.piece),u=en[f](r.color);if(i>=0&&u>=0)return e[t][n]=i*2+u,e[d]=c,h}return s}function dn(t){return en[t[e]]}function vn(t,n){var r=sn(n);return r>=0?(t[e]=r,t[d]=c,h):s}function mn(e,t,n){return(e[i][t]&1<<n)!==0}function gn(e,t,n,r){return typeof r===at?(r?e[i][t]|=1<<n:e[i][t]&=~(1<<n),e[d]=c,h):s}function yn(e){return e[r]<0?ft:nn[e[r]]}function bn(e,t){if(t===ft)return e[r]=-1,e[d]=c,h;if(typeof t===o){var n=nn[f](t);if(n>=0)return e[r]=n,e[d]=c,h}return s}function wn(e,n,r){var i=Jt[r];if(Vt(r))for(var o=0;o<i[a];++o){var u=n;while(h){u-=i[o];if((u&136)===0){var f=e[t][u];if(f===r)return h;if(f===Ct)continue}break}}else for(var o=0;o<i[a];++o){var u=n-i[o];if((u&136)===0&&e[t][u]===r)return h}return s}function En(e,t,n){for(var r=0;r<6;++r)if(wn(e,t,r*2+n))return h;return s}function Sn(n){if(n[d]!==c)return;n[d]=s,xn(n,Tt),xn(n,Nt);if(n[v][Tt]<0||n[v][Nt]<0)return;if(En(n,n[v][1-n[e]],n[e]))return;for(var i=0;i<8;++i){var o=n[t][i],u=n[t][112+i];if(o===Wt||u===Wt||o===Xt||u===Xt)return}for(var a=0;a<2;++a){var f=!mn(n,a,7),l=!mn(n,a,0),p=f||n[t][7+112*a]===Ot*2+a,m=l||n[t][0+112*a]===Ot*2+a,g=f&&l||n[t][4+112*a]===Lt*2+a;if(!(g&&m&&p))return}if(n[r]>=0){var y=(6-n[e]*5)*16+n[r],b=(5-n[e]*3)*16+n[r],w=(4-n[e])*16+n[r];if(n[t][y]!==Ct||n[t][b]!==Ct||n[t][w]!==Dt*2+1-n[e])return}n[d]=h}function xn(e,n){var r=Lt*2+n;e[v][n]=-1;for(var i=0;i<120;i+=(i&7)===7?9:1)if(e[t][i]===r){if(!(e[v][n]<0)){e[v][n]=-1;return}e[v][n]=i}}function Nn(){if(arguments[0]instanceof Nn)this[H]=Tn[st],this[p]=arguments[0][p],this[j]=arguments[0][j],this[A]=arguments[0][A],this[z]=arguments[0][z],this._to=arguments[0]._to,this[et]=arguments[1];else{this[H]=arguments[0],this[p]=arguments[1],this[j]=arguments[2],this[A]=arguments[3],this[z]=arguments[4],this._to=arguments[5];switch(this[H]){case Tn[b]:this[ht]=arguments[6],this._rookTo=arguments[7];break;case Tn[w]:this[R]=arguments[6];break;case Tn[y]:this[x]=arguments[6];break;default:}}}function Cn(n,o){if(!n[P]())return;for(var u=0;u<120;u+=(u&7)===7?9:1){var f=n[t][u],l=Math[K](f/2);if(f<0||f%2!==n[e])continue;if(l===Dt){var c=Jt[f];for(var h=0;h<c[a];++h){var p=u+c[h];if((p&136)===0){var d=n[t][p];d>=0&&d%2!==n[e]?o(Ln(n,u,p,-1,-1),p<8||p>=112):d<0&&p===(5-n[e]*3)*16+n[r]&&o(Ln(n,u,p,(4-n[e])*16+n[r],-1),s)}}var v=16-n[e]*32,p=u+v;if(n[t][p]<0){o(Ln(n,u,p,-1,-1),p<8||p>=112);var m=(1+n[e]*5)*16;u>=m&&u<m+8&&(p+=v,n[t][p]<0&&o(Ln(n,u,p,-1,u%8),s))}}else if(Vt(f)){var g=Jt[f];for(var h=0;h<g[a];++h)for(var p=u+g[h];(p&136)===0;p+=g[h]){var d=n[t][p];(d<0||d%2!==n[e])&&o(Ln(n,u,p,-1,-1),s);if(d>=0)break}}else{var g=Jt[f];for(var h=0;h<g[a];++h){var p=u+g[h];if((p&136)===0){var d=n[t][p];(d<0||d%2!==n[e])&&o(Ln(n,u,p,-1,-1),s)}}}if(l===Lt&&n[i][n[e]]!==0){var p=[u-2,u+2];for(var h=0;h<p[a];++h)o(An(n,u,p[h]),s)}}}function kn(n,i,o,u){if(!n[P]())return s;var a=n[t][i],f=n[t][o],l=Math[K](a/2);if(a<0||a%2!==n[e])return s;if(l===Dt&&(o<8||o>=112)){if(!$t(u))return s}else if(u>=0)return s;var c=o-i+119,h=-1,p=-1;if((Kt[c]&1<<a)===0){if(l!==Dt||c!==151-n[e]*64)return l!==Lt||c!==117&&c!==121?s:An(n,i,o);var d=(1+n[e]*5)*16;if(i<d||i>=d+8)return s;p=i%8}if(l===Dt){if(c===135-n[e]*32||p>=0){if(f!==Ct)return s}else if(f===Ct){if(n[r]<0||o!==(5-n[e]*3)*16+n[r])return s;h=(4-n[e])*16+n[r]}else if(f%2===n[e])return s}else if(f>=0&&f%2===n[e])return s;if(Vt(a)){var v=Qt[c];for(var m=i+v;m!==o;m+=v)if(n[t][m]!==Ct)return s}else if(p>=0&&n[t][(i+o)/2]!==Ct)return s;var g=Ln(n,i,o,h,p);return g&&u>=0?new Nn(g,u):g}function Ln(n,r,i,o,u){var a=n[t][r],f=n[t][i],l=Math[K](a/2);n[t][i]=a,n[t][r]=Ct,o>=0&&(n[t][o]=Ct);var c=l===Lt?i:n[v][n[e]],p=En(n,c,1-n[e]);return n[t][r]=a,n[t][i]=f,o>=0&&(n[t][o]=Dt*2+1-n[e]),p?s:o>=0?new Nn(Tn[w],l,n[e],h,r,i,o):u>=0?new Nn(Tn[y],l,n[e],s,r,i,u):new Nn(Tn.NORMAL_MOVE,l,n[e],f>=0,r,i)}function An(n,r,o){var u=r<o?7:0;if((n[i][n[e]]&1<<u)===0)return s;var a=u+n[e]*112,f=(r+o)/2,l=r<a?1:-1;for(var c=r+l;c!==a;c+=l)if(n[t][c]!==Ct)return s;var h=1-n[e];return En(n,r,h)||En(n,o,h)||En(n,f,h)?s:new Nn(Tn[b],Lt,n[e],s,r,o,a,f)}function On(e,t){var n="";return t[H]===Tn[b]?n=t[z]<t._to?"O-O":"O-O-O":t[p]===Dt?(t[A]&&(n+=nn[t[z]%16]+"x"),n+=on(t._to),t[H]===Tn[st]&&(n+="="+Zt[t[et]].toUpperCase())):(n+=Zt[t[p]].toUpperCase(),n+=_n(e,t[z],t._to),t[A]&&(n+="x"),n+=on(t._to)),n+=Mn(e,t),n}function Mn(e,t){var n=new un(e);return n.play(t),n.isCheck()?n[mt]()?"+":"#":""}function _n(e,n,r){var i=Dn(e,r,e[t][n]);if(i[a]>=2){var o=s,u=s,f=s,l=Math[K](n/16),c=n%16;for(var p=0;p<i[a];++p){var d=i[p];if(d===n)continue;Ln(e,d,r,-1,-1)&&(o=h,l===Math[K](d/16)&&(u=h),c===d%16&&(f=h))}return f?u?on(n):tn[l]:o?nn[c]:""}return""}function Dn(e,n,r){var i=[],s=Jt[r];if(Vt(r))for(var o=0;o<s[a];++o){var u=n;while(h){u-=s[o];if((u&136)===0){var f=e[t][u];if(f===r)i.push(u);else if(f===Ct)continue}break}}else for(var o=0;o<s[a];++o){var u=n-s[o];(u&136)===0&&e[t][u]===r&&i.push(u)}return i}function Pn(n,r,i){var s=/^(?:(O-O-O)|(O-O)|([KQRBN])([a-h])?([1-8])?(x)?([a-h][1-8])|(?:([a-h])(x)?)?([a-h][1-8])(?:(=)?([KQRBNP]))?)([\+#])?$/.exec(r);if(s===c)throw new xt(n,r,wt[_]);if(!n[P]())throw new xt(n,r,wt[lt]);var o=c;if(s[1]||s[2]){var u=n[v][n[e]],l=u+(s[2]?2:-2);o=An(n,u,l);if(!o){var h=s[2]?wt[U]:wt[q];throw new xt(n,r,h)}}else if(s[3]){var p=Zt[f](s[3].toLowerCase()),l=rn(s[7]),d=n[t][l];if(d>=0&&d%2===n[e])throw new xt(n,r,wt[O]);var m=Dn(n,l,p*2+n[e]);if(s[4]){var g=nn[f](s[4]);m=m.filter(function(e){return e%16===g})}if(s[5]){var y=tn[f](s[5]);m=m.filter(function(e){return Math[K](e/16)===y})}if(m[a]===0){var h=s[4]||s[5]?wt[k]:wt[tt];throw new xt(n,r,h,s[3],s[7])}for(var b=0;b<m[a];++b){var w=Ln(n,m[b],l,-1,-1);if(w){if(o!==c)throw new xt(n,r,wt[Q],s[3],s[7]);o=w}}if(o===c){var h=n[e]===Tt?wt[S]:wt[E];throw new xt(n,r,h)}if(i){var x=_n(n,o[z],l),T=(s[4]?s[4]:"")+(s[5]?s[5]:"");if(x!==T)throw new xt(n,r,wt[B],x,T)}}else if(s[10]){var l=rn(s[10]);s[8]?o=Hn(n,r,nn[f](s[8]),l):o=Bn(n,r,l);if(!o){var h=n[e]===Tt?wt[S]:wt[E];throw new xt(n,r,h)}if(l<8||l>=112){if(!s[12])throw new xt(n,r,wt[ut]);var N=Zt[f](s[12].toLowerCase());if(!$t(N))throw new xt(n,r,wt[Z],s[12]);o=new Nn(o,N);if(i&&!s[11])throw new xt(n,r,wt[J])}else if(s[12])throw new xt(n,r,wt[ot])}if(i){if(o[pt]()!==(s[6]||s[9])){var h=o[pt]()?wt[G]:wt[Y];throw new xt(n,r,h)}var C=Mn(n,o),L=s[13]?s[13]:"";if(C!==L)throw new xt(n,r,wt[D],C,L)}return o}function Hn(n,i,s,o){var a=o-16+n[e]*32;if((a&136)!==0)throw new xt(n,i,wt[u]);var f=o%16;if(f-s===1)a-=1;else{if(f-s!==-1)throw new xt(n,i,wt[u]);a+=1}if(n[t][a]!==Dt*2+n[e])throw new xt(n,i,wt[u]);var l=n[t][o];if(l<0){if(o===(5-n[e]*3)*16+n[r])return Ln(n,a,o,(4-n[e])*16+n[r],-1)}else if(l%2!==n[e])return Ln(n,a,o,-1,-1);throw new xt(n,i,wt[u])}function Bn(n,r,i){var s=16-n[e]*32,o=i-s;if((o&136)!==0)throw new xt(n,r,wt[l]);if(n[t][i]>=0)throw new xt(n,r,wt[l]);var u=Dt*2+n[e];if(n[t][o]===u)return Ln(n,o,i,-1,-1);if(n[t][o]<0){o-=s;var a=(1+n[e]*5)*16;if(o>=a&&o<a+8&&n[t][o]===u)return Ln(n,o,i,-1,i%16)}throw new xt(n,r,wt[l])}var e="_turn",t="_board",n="prototype",r="_enPassant",i="_castleRights",s=!1,o="string",u="INVALID_CAPTURING_PAWN_MOVE",a="length",f="indexOf",l="INVALID_NON_CAPTURING_PAWN_MOVE",c=null,h=!0,p="_movingPiece",d="_legal",v="_king",m="undefined",g="INVALID_MOVE_COUNTING_FIELD",y="TWO_SQUARE_PAWN_MOVE",b="CASTLING_MOVE",w="EN_PASSANT_CAPTURE",E="NOT_SAFE_FOR_BLACK_KING",S="NOT_SAFE_FOR_WHITE_KING",x="_twoSquarePawnMoveColumn",T="UNEXPECTED_END_OF_SUBFIELD_IN_BOARD_FIELD",N="WRONG_NUMBER_OF_SUBFIELDS_IN_BOARD_FIELD",C="+---+---+---+---+---+---+---+---+\n",k="NO_PIECE_CAN_MOVE_TO_DISAMBIGUATION",L="UNEXPECTED_CHARACTER_IN_BOARD_FIELD",A="_isCapture",O="TRYING_TO_CAPTURE_YOUR_OWN_PIECES",M="WRONG_ROW_IN_EN_PASSANT_FIELD",_="INVALID_MOVE_NOTATION_SYNTAX",D="WRONG_CHECK_CHECKMATE_SYMBOL",P="isLegal",H="_type",B="WRONG_DISAMBIGUATION_SYMBOL",j="_movingColor",F="INVALID_CASTLE_RIGHTS_FIELD",I="message",q="ILLEGAL_QUEEN_SIDE_CASTLING",R="_enPassantSquare",U="ILLEGAL_KING_SIDE_CASTLING",z="_from",W="WRONG_NUMBER_OF_FEN_FIELDS",X="Position#castleRights()",V="INVALID_EN_PASSANT_FIELD",$="Position#isAttacked()",J="MISSING_PROMOTION_SYMBOL",K="floor",Q="REQUIRE_DISAMBIGUATION",G="MISSING_CAPTURE_SYMBOL",Y="INVALID_CAPTURE_SYMBOL",Z="INVALID_PROMOTED_PIECE",et="_promotion",tt="NO_PIECE_CAN_MOVE_TO",nt="ORDINALS",rt="Position#square()",it="INVALID_TURN_FIELD",st="PROMOTION",ot="ILLEGAL_PROMOTION",ut="MISSING_PROMOTION",at="boolean",ft="-",lt="ILLEGAL_POSITION",ct="object",ht="_rookFrom",pt="isCapture",dt="promotion",vt="isNullMoveLegal",mt="hasMove",gt=" ",yt="fiftyMoveClock",bt="fullMoveNumber",wt={};wt[nt]=["1st","2nd","3rd","4th","5th","6th","7th","8th"],wt[W]="A FEN string must contain exactly 6 space-separated fields.",wt[N]="The 1st field of a FEN string must contain exactly 8 `/`-separated subfields.",wt[L]="Unexpected character in the 1st field of the FEN string: `%1$s`.",wt[T]="The %1$s subfield of the FEN string 1st field is unexpectedly short.",wt[it]="The 2nd field of a FEN string must be either `w` or `b`.",wt[F]="The 3rd field of a FEN string must be either `-` or a list of characters among `K`, `Q`, `k` and `q` (in this order).",wt[V]="The 4th field of a FEN string must be either `-` or a square from the 3rd or 6th row where en-passant is allowed.",wt[M]="The row number indicated in the FEN string 4th field is inconsistent with respect to the 2nd field.",wt[g]="The %1$s field of a FEN string must be a number.",wt[_]="The syntax of the move notation is invalid.",wt[lt]="The position is not legal.",wt[q]="Queen-side castling is not legal in the considered position.",wt[U]="King-side castling is not legal in the considered position.",wt[tt]="No %1$s can move to %2$s.",wt[k]="No %1$s on the specified row/column can move to %2$s.",wt[Q]="Cannot determine uniquely which %1$s is supposed to move to %2$s.",wt[B]="Wrong disambiguation symbol (expected: `%1$s`, observed: `%2$s`).",wt[O]="Capturing its own pieces is not legal.",wt[u]="Invalid capturing pawn move.",wt[l]="Invalid non-capturing pawn move.",wt[S]="This move would put let the white king in check.",wt[E]="This move would put let the black king in check.",wt[ut]="A promoted piece must be specified for this move.",wt[J]="Character `=` is required to specify a promoted piece.",wt[Z]="%1$s cannot be specified as a promoted piece.",wt[ot]="Specifying a promoted piece is illegal for this move.",wt[G]="Capture symbol `x` is missing.",wt[Y]="This move is not a capture move.",wt[D]="Wrong check/checkmate symbol (expected: `%1$s`, observed: `%2$s`).";var Tt=0,Nt=1,Ct=-1,kt=-2,Lt=0,At=1,Ot=2,Mt=3,_t=4,Dt=5,Pt=0,Ht=1,Bt=2,jt=3,Ft=4,It=5,qt=6,Rt=7,Ut=8,zt=9,Wt=10,Xt=11,Jt=[[-17,-16,-15,-1,1,15,16,17],[-17,-16,-15,-1,1,15,16,17],[-17,-16,-15,-1,1,15,16,17],[-17,-16,-15,-1,1,15,16,17],[-16,-1,1,16],[-16,-1,1,16],[-17,-15,15,17],[-17,-15,15,17],[-33,-31,-18,-14,14,18,31,33],[-33,-31,-18,-14,14,18,31,33],[15,17],[-17,-15]],Kt=[204,0,0,0,0,0,0,60,0,0,0,0,0,0,204,0,0,204,0,0,0,0,0,60,0,0,0,0,0,204,0,0,0,0,204,0,0,0,0,60,0,0,0,0,204,0,0,0,0,0,0,204,0,0,0,60,0,0,0,204,0,0,0,0,0,0,0,0,204,0,0,60,0,0,204,0,0,0,0,0,0,0,0,0,0,204,768,60,768,204,0,0,0,0,0,0,0,0,0,0,0,768,2255,2111,2255,768,0,0,0,0,0,0,60,60,60,60,60,60,63,0,63,60,60,60,60,60,60,0,0,0,0,0,0,768,1231,1087,1231,768,0,0,0,0,0,0,0,0,0,0,0,204,768,60,768,204,0,0,0,0,0,0,0,0,0,0,204,0,0,60,0,0,204,0,0,0,0,0,0,0,0,204,0,0,0,60,0,0,0,204,0,0,0,0,0,0,204,0,0,0,0,60,0,0,0,0,204,0,0,0,0,204,0,0,0,0,0,60,0,0,0,0,0,204,0,0,204,0,0,0,0,0,0,60,0,0,0,0,0,0,204,0],Qt=[-17,0,0,0,0,0,0,-16,0,0,0,0,0,0,-15,0,0,-17,0,0,0,0,0,-16,0,0,0,0,0,-15,0,0,0,0,-17,0,0,0,0,-16,0,0,0,0,-15,0,0,0,0,0,0,-17,0,0,0,-16,0,0,0,-15,0,0,0,0,0,0,0,0,-17,0,0,-16,0,0,-15,0,0,0,0,0,0,0,0,0,0,-17,0,-16,0,-15,0,0,0,0,0,0,0,0,0,0,0,0,-17,-16,-15,0,0,0,0,0,0,0,-1,-1,-1,-1,-1,-1,-1,0,1,1,1,1,1,1,1,0,0,0,0,0,0,0,15,16,17,0,0,0,0,0,0,0,0,0,0,0,0,15,0,16,0,17,0,0,0,0,0,0,0,0,0,0,15,0,0,16,0,0,17,0,0,0,0,0,0,0,0,15,0,0,0,16,0,0,0,17,0,0,0,0,0,0,15,0,0,0,0,16,0,0,0,0,17,0,0,0,0,15,0,0,0,0,0,16,0,0,0,0,0,17,0,0,15,0,0,0,0,0,0,16,0,0,0,0,0,0,17,0],Yt="KkQqRrBbNnPp",Zt="kqrbnp",en="wb",tn="12345678",nn="abcdefgh";un[n].clear=function(){this[t]=[Ct,Ct,Ct,Ct,Ct,Ct,Ct,Ct,kt,kt,kt,kt,kt,kt,kt,kt,Ct,Ct,Ct,Ct,Ct,Ct,Ct,Ct,kt,kt,kt,kt,kt,kt,kt,kt,Ct,Ct,Ct,Ct,Ct,Ct,Ct,Ct,kt,kt,kt,kt,kt,kt,kt,kt,Ct,Ct,Ct,Ct,Ct,Ct,Ct,Ct,kt,kt,kt,kt,kt,kt,kt,kt,Ct,Ct,Ct,Ct,Ct,Ct,Ct,Ct,kt,kt,kt,kt,kt,kt,kt,kt,Ct,Ct,Ct,Ct,Ct,Ct,Ct,Ct,kt,kt,kt,kt,kt,kt,kt,kt,Ct,Ct,Ct,Ct,Ct,Ct,Ct,Ct,kt,kt,kt,kt,kt,kt,kt,kt,Ct,Ct,Ct,Ct,Ct,Ct,Ct,Ct],this[e]=Tt,this[i]=[0,0],this[r]=-1,this[d]=s,this[v]=[-1,-1]},un[n].reset=function(){this[t]=[Ft,Ut,qt,Bt,Pt,qt,Ut,Ft,kt,kt,kt,kt,kt,kt,kt,kt,Wt,Wt,Wt,Wt,Wt,Wt,Wt,Wt,kt,kt,kt,kt,kt,kt,kt,kt,Ct,Ct,Ct,Ct,Ct,Ct,Ct,Ct,kt,kt,kt,kt,kt,kt,kt,kt,Ct,Ct,Ct,Ct,Ct,Ct,Ct,Ct,kt,kt,kt,kt,kt,kt,kt,kt,Ct,Ct,Ct,Ct,Ct,Ct,Ct,Ct,kt,kt,kt,kt,kt,kt,kt,kt,Ct,Ct,Ct,Ct,Ct,Ct,Ct,Ct,kt,kt,kt,kt,kt,kt,kt,kt,Xt,Xt,Xt,Xt,Xt,Xt,Xt,Xt,kt,kt,kt,kt,kt,kt,kt,kt,It,zt,Rt,jt,Ht,Rt,zt,It],this[e]=Tt,this[i]=[129,129],this[r]=-1,this[d]=h,this[v]=[4,116]},un[n].ascii=function(){var n=C;for(var s=7;s>=0;--s){for(var o=0;o<8;++o){var u=this[t][s*16+o];n+="| "+(u<0?gt:Yt[u])+gt}n+="|\n",n+=C}return n+=en[this[e]]+gt,n+=ln(this[i])+gt,n+=this[r]<0?ft:nn[this[r]],n},un[n].fen=function(){if(arguments[a]===0)return an(this,0,1);if(arguments[a]===1&&typeof arguments[0]===ct){var e=typeof arguments[0][yt]=="number"?arguments[0][yt]:0,t=typeof arguments[0][bt]=="number"?arguments[0][bt]:1;return an(this,e,t)}if(arguments[a]===1&&typeof arguments[0]===o)return fn(this,arguments[0],s);if(arguments[a]>=2&&typeof arguments[0]===o&&typeof arguments[1]===at)return fn(this,arguments[0],arguments[1]);throw new Et("Position#fen()")},un[n].square=function(e,t){e=rn(e);if(e<0)throw new Et(rt);if(typeof t===m||t===c)return hn(this,e);if(!pn(this,e,t))throw new Et(rt)},un[n].turn=function(e){if(typeof e===m||e===c)return dn(this);if(!vn(this,e))throw new Et("Position#turn()")},un[n].castleRights=function(e,t,n){e=sn(e);if(e<0||t!=="k"&&t!=="q")throw new Et(X);var r=t==="k"?7:0;if(typeof n===m||n===c)return mn(this,e,r);if(!gn(this,e,r,n))throw new Et(X)},un[n].enPassant=function(e){if(typeof e===m||e===c)return yn(this);if(!bn(this,e))throw new Et("Position#enPassant()")},un[n].isAttacked=function(e,t,n){e=rn(e),t=sn(t);if(e<0||t<0)throw new Et($);if(typeof n===m||n===c)return En(this,e,t);if(typeof n===o){for(var r=0;r<Zt[a];++r)if(n[f](Zt[r])>=0&&wn(this,e,r*2+t))return h;return s}throw new Et($)},un[n][P]=function(){return Sn(this),this[d]},un[n].kingSquare=function(e){e=sn(e);if(e<0)throw new Et("Position#kingSquare()");Sn(this);var t=this[v][e];return t<0?ft:on(t)};var Tn={NORMAL_MOVE:0,CASTLING_MOVE:1,EN_PASSANT_CAPTURE:2,TWO_SQUARE_PAWN_MOVE:3,PROMOTION:4};return Nn[n].type=function(){return this[H]},Nn[n].movingPiece=function(){return Zt[this[p]]},Nn[n].movingColor=function(){return en[this[j]]},Nn[n][pt]=function(){return this[A]},Nn[n].from=function(){return on(this[z])},Nn[n].to=function(){return on(this._to)},Nn[n].rookFrom=function(){return this[H]===Tn[b]?on(this[ht]):ft},Nn[n].rookTo=function(){return this[H]===Tn[b]?on(this._rookTo):ft},Nn[n].enPassantSquare=function(){return this[H]===Tn[w]?on(this[R]):ft},Nn[n].twoSquarePawnMoveColumn=function(){return this[H]===Tn[y]?nn[this[x]]:ft},Nn[n][dt]=function(){return this[H]===Tn[st]?Zt[this[et]]:ft},un[n].isCheck=function(){return this[P]()&&En(this,this[v][this[e]],1-this[e])},un[n].isCheckmate=function(){return this[P]()&&!this[mt]()&&En(this,this[v][this[e]],1-this[e])},un[n].isStalemate=function(){return this[P]()&&!this[mt]()&&!En(this,this[v][this[e]],1-this[e])},un[n].isMoveLegal=function(e){if(typeof e===o)try{return Pn(this,e,s)}catch(t){if(t instanceof xt)return s;throw t}else if(typeof e===ct&&e!==c&&typeof e.from===o&&typeof e.to===o){var n=rn(e.from),r=rn(e.to);if(n>=0&&r>=0){if(typeof e[dt]!==o)return kn(this,n,r,-1);var i=Zt[f](e[dt]);if(i>=0)return kn(this,n,r,i)}}throw new Et("Position#isMoveLegal()")},un[n][mt]=function(){function e(){}try{return Cn(this,function(t){if(t)throw new e}),s}catch(t){if(t instanceof e)return h;throw t}},un[n].moves=function(){var e=[];return Cn(this,function(t,n){t&&(n?(e.push(new Nn(t,At)),e.push(new Nn(t,Ot)),e.push(new Nn(t,Mt)),e.push(new Nn(t,_t))):e.push(t))}),e},un[n].play=function(n){var o=n instanceof Nn?n:this.isMoveLegal(n);if(o){var u=o[H]===Tn[st]?o[et]*2+this[e]:this[t][o[z]];return this[t][o[z]]=Ct,o[H]===Tn[w]?this[t][o[R]]=Ct:o[H]===Tn[b]&&(this[t][o[ht]]=Ct,this[t][o._rookTo]=Ot*2+this[e]),this[t][o._to]=u,o[p]===Lt&&(this[i][this[e]]=0),o[z]<8&&(this[i][Tt]&=~(1<<o[z])),o._to<8&&(this[i][Tt]&=~(1<<o._to)),o[z]>=112&&(this[i][Nt]&=~(1<<o[z]%16)),o._to>=112&&(this[i][Nt]&=~(1<<o._to%16)),this[r]=o[H]===Tn[y]?o[x]:-1,o[p]===Lt&&(this[v][this[e]]=o._to),this[e]=1-this[e],h}return s},un[n][vt]=function(){return this[P]()&&!En(this,this[v][this[e]],1-this[e])},un[n].playNullMove=function(){return this[vt]()?(this[e]=1-this[e],this[r]=-1,h):s},un[n].notation=function(){if(arguments[a]===1&&arguments[0]instanceof Nn)return On(this,arguments[0]);if(arguments[a]===1&&typeof arguments[0]===o)return Pn(this,arguments[0],s);if(arguments[a]>=2&&typeof arguments[0]===o&&typeof arguments[1]===at)return Pn(this,arguments[0],arguments[1]);throw new Et("Position#notation()")},{i18n:wt,exceptions:{IllegalArgument:Et,InvalidFEN:St,InvalidNotation:xt},squareColor:Gt,Position:un,movetype:Tn,MoveDescriptor:Nn}}();